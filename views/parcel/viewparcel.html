<div ng-include="'views/head.html'"></div>
<div class="container" ng-controller="viewparcelController">
    <div class="tab-form-new">
        <div ng-include="'views/dashboardmenu.html'"></div>
        <!-- Tab panes -->
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="Dashboard">
                <div class="row">
                    <div class="col-md-12 inner-tab-form-new">
                        <div class="row">
                            <div class="col-md-2">
                                <div ng-include="'views/parcel/sendermenu.html'"></div>
                                <div class="clear">&nbsp;&nbsp;</div>
                                <form name="searchcouriers" ng-submit="search()" class="stdform" id="srch-trans-frm" enctype="multipart/form-data" method="post" accept-charset="utf-8">
                                    <h1>Search Trip</h1>
                                    <div style="background:#3b5998 none repeat scroll 0 0;float:left;color:#ffffff;width:100%;">
                                        <div class="form-group">
                                            <label class="col-md-12 control-label" for="textinput">From</label>
                                            <div class="col-md-12">
                                                <input id="textinput" maxlength="200" name="textinput" ng-model="searchfromlocation" ui-autocomplete="locationStateOption" placeholder="eg :Jaipur" class="form-control input-md" type="text" />
                                            </div>
                                            <label class="col-md-12 control-label" for="textinput">To</label>
                                            <div class="col-md-12">
                                                <input id="textinput" maxlength="200" name="textinput" ng-model="searchtolocation" ui-autocomplete="locationStateOption" placeholder="eg :New Delhi" class="form-control input-md" type="text" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-12 control-label" for="textinput">From Date</label>
                                            <div class="col-md-12">
                                                <div class='input-group date' id='datetimepicker1'>
                                                    <input maxlength="100" type='text' name="data" placeholder="DD-MM-YYYY" value="{{ dateFromsearch | date:'dd-MM-yyyy' }}" class="quote_datesearch form-control" />
                                                </div>
                                            </div>

                                            <label class="col-md-12 control-label" for="textinput">To Date</label>
                                            <div class="col-md-12">
                                                <div class='input-group date' id='datetimepicker1'>
                                                    <input maxlength="100" type='text' name="data" value="{{ dateTosearch | date:'dd-MM-yyyy' }}" placeholder="DD-MM-YYYY" class="quote_datesearch1 form-control" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-md-12">
                                                <input class="customsearchbutton" style="font-size:15px; width:100%;text-shadow: 0px 1px 3px rgba(0, 0, 0, 0.4);  color:#fff;font-family: 'proxima_novasemibold'; text-transform:uppercase;    background: -moz-linear-gradient(270deg, rgba(144,193,81,1) 0%, rgba(107,162,35,1) 100%);     background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, rgba(144,193,81,1)), color-stop(100%, rgba(107,162,35,1)));     background: -webkit-linear-gradient(270deg, rgba(144,193,81,1) 0%, rgba(107,162,35,1) 100%);     background: -o-linear-gradient(270deg, rgba(144,193,81,1) 0%, rgba(107,162,35,1) 100%);      background: -ms-linear-gradient(270deg, rgba(144,193,81,1) 0%, rgba(107,162,35,1) 100%);     background: linear-gradient(180deg, rgba(144,193,81,1) 0%, rgba(107,162,35,1) 100%);     filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#90c151', endColorstr='#6ba223',GradientType=0 ); " type="submit" value="Search">
                                            </div>
                                        </div>
                                    </div>
                                </form>
                                <div class="clear">&nbsp;&nbsp;</div>
                            </div>
                            <div class="col-md-10" ng-hide="issummary">
                                <h1>View Parcel {{parcel.ParcelID}}</h1>
                                <a href='/editparcel/{{parcel.id}}' style="float:right;background: #3b5998;border: 0;color: #fff;padding:5px 15px;margin:5px 0 5px 0;" title='Cancel Parcel'>Edit Parcel</a>
                                <a ng-hide="parcel.status==7 || parcel.status==5" href='javascript:void(0);' style="float:right;background: #3b5998;border: 0;color: #fff;padding:5px 15px;margin:5px 5px 5px 0;" ng-click='cancelparcellist(parcel.id)' title='Cancel Parcel'>Cancel Parcel</a>
                                <div ng-show="parcel.status == 4">
                                    <a href='javascript:void(0);' ng-click='changestatusparcel(parcel.id,1)' title='Cancel Status' style="float:right;background: #3b5998;border: 0;color: #fff;padding:5px 15px;margin:5px 5px 5px 0;">Received</a>
                                    <a href='javascript:void(0);' ng-click='changestatusparcel(parcel.id, 0)' title='Cancel Status' style="float:right;background: #3b5998;border: 0;color: #fff;padding:5px 15px;margin:5px 5px 5px 0;">Not Received</a>
                                </div>

                                <table id="example2" class="table table-striped table-bordered dt-responsive nowrap">
                                    <thead>
                                        <tr>
                                            <th>&nbsp;<b>From</b>&nbsp;</th>
                                            <th>&nbsp;<b>To</b>&nbsp;</th>
                                            <th>&nbsp;<b>Till Date</b>&nbsp;</th>
                                            <th>&nbsp;<b>Parcel Type</b>&nbsp;</th>
                                            <th><b>Weight(kg)</b></th>
                                            <th ng-show="parcel.type=='B'"><b>Dimension(inches)</b></th>
                                            <th><b>Parcel Description</b></th>
                                            <th>&nbsp;<b>Status</b>&nbsp;</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>{{parcel.source}}</td>
                                            <td>{{parcel.destination}}</td>
                                            <td>{{parcel.till_date}}</td>
                                            <td>{{parcel.type=='E'?'Envelope':parcel.type=='B'?'Box':parcel.type=='P'?'Packet':parcel.type}}</td>
                                            <td>{{parcel.weight}}kg.</td>
                                            <td ng-show="parcel.type=='B'">{{parcel.height}}'' {{parcel.width}}'' {{parcel.length}}''</td>
                                            <td>{{parcel.description}}</td>
                                            <td>
                                                <div class="alert-success" ng-show='parcel.status==2'><i class="fa fa-check fa-2x">&nbsp;&nbsp;&nbsp;</i>{{ parcel.statusdescription }}</div>
                                                <span ng-hide='parcel.status==2'>
                                                    &nbsp;
                                                    {{ parcel.statusdescription }}&nbsp;
                                                </span>
                                            </td>
                                            <!--<td ng-hide='!parcel.reason'>{{parcel.reason}}</td>-->
                                        </tr>
                                    </tbody>
                                </table>
                                <div ng-show="trip.length>0">
                                    <h1>Booking Detail</h1>
                                    <div class="round hollow text-center" ng-show="parcel.channelid>0">
                                        <a href="javascript:void(0);" id="addClass"><span class="glyphicon glyphicon-comment"></span>Chat</a>
                                    </div>
                                    <h4>Transporter Details</h4>

                                    <table class="table table-striped table-bordered dt-responsive nowrap">
                                        <tr>
                                            <th><b>Email</b></th>
                                            <th><b>Name</b></th>
                                            <th><b>Departure Time</b></th>
                                            <th><b>Arrival Time</b></th>
                                            <th><b>Flight No.</b></th>
                                        </tr>
                                        <tr>
                                            <td>{{trip[0].transporteremail}}</td>
                                            <td>{{trip[0].transportername}}</td>
                                            <td>{{trip[0].dep_time}}</td>
                                            <td>{{trip[0].arrival_time}}</td>
                                            <td>{{trip[0].flight_no}}</td>
                                        </tr>
                                    </table>
                                    <h4>Receiver Details</h4>
                                    <table class="table table-striped table-bordered dt-responsive nowrap">
                                        <tr>
                                            <td><b>Name</b></td>
                                            <td><b>Email</b></td>
                                            <td>Mobile</td>
                                        </tr>
                                        <tr>
                                            <td>{{userlist[0].name}}</td>
                                            <td>{{userlist[0].username}}</td>
                                            <td>
                                                {{userlist[0].country_code == ''?'':'+'+parcel[0].country_code+'-'}}{{userlist[0].mobile}}
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div id="what" ng-hide="tripsmatch.length==0" class="gridsystem">
                                    <div class="row">
                                        <h1>Transporter's Match Found</h1>
                                        <table id="example" class="table table-striped table-bordered dt-responsive nowrap">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>From </th>
                                                    <th>To</th>
                                                    <th>Dep Time</th>
                                                    <th>Arrival Time</th>
                                                    <th>Capacity (kg.)</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                                <div ng-show="tripsmatch.length==0 && parcel.status == 0" class="gridsystem">
                                    <div class="alert alert-success" role="alert">No Trip Found.<p>We have received your request we will find a match and inform you shortly. </p></div>

                                </div>
                                <div class="clear">&nbsp;&nbsp;</div>
                            </div>
                            <div class="col-md-10" ng-show="issummary">
                                <div class="search-result book-now a-left">
                                    <h1>Confirm Booking</h1>
                                    <form ng-submit="generateordernumber()" class="stdform" id="accept-and-pay" enctype="multipart/form-data" method="post" accept-charset="utf-8">
                                        <div class="clear">
                                            <div class="f-left"><label>From </label></div>
                                            <div class="f-right">
                                                <b>-</b>
                                                {{ parcel.source }}
                                            </div>
                                        </div>
                                        <div class="clear">
                                            <div class="f-left"><label>To </label></div>
                                            <div class="f-right">
                                                <b>-</b>
                                                {{ parcel.destination }}
                                            </div>

                                        </div>
                                        <div class="clear">
                                            <div class="f-left"><label>Parcel type</label></div>
                                            <div class="f-right">
                                                <b>-</b>  {{parcel.type=='E'?'Envelope':parcel.type=='B'?'Box':parcel.type=='P'?'Packet':parcel.type}}
                                            </div>
                                        </div>
                                        <div class="clear p-size" ng-show="parcel.type=='B'">
                                            <div class="f-left"><label>Parcel Dimension</label></div>
                                            <div class="f-right">
                                                <b>-</b>
                                                H {{parcel.height}}" , W {{parcel.width}}" , L {{parcel.length}}"
                                            </div>
                                        </div>
                                        <div class="clear p-size">
                                            <div class="f-left"><label>Parcel Weight</label></div>
                                            <div class="f-right">
                                                <b>-</b>
                                                {{parcel.weight}}kg
                                            </div>
                                        </div>
                                        <div class="clear">
                                            <div class="f-left"><label>Parcel Description</label></div>
                                            <div class="f-right a-justify">
                                                <b>-</b>
                                                {{parcel.description}}
                                            </div>
                                        </div>
                                        <div class="clear">
                                            <div class="f-left"><label>{{parcel.status==7?'Amount Payed':'Amount To Pay'}}</label></div>
                                            <div class="f-right a-justify">
                                                <b>-</b>
                                                <i class="fa fa-inr"></i>&nbsp; {{parcel.payment}}
                                            </div>
                                        </div>
                                        <hr />
                                        <h1>Receiver Details </h1>
                                        <div class="com-det">
                                            <table border="0" cellpadding="4" width="100%">
                                                <tbody>
                                                    <tr ng-repeat="user in userlist">
                                                        <td><b>MCB Id</b>{{user.UserID}}</td>
                                                        <td><b>Email</b>{{user.username}}</td>
                                                        <td><b>Name</b>{{user.name}} </td>
                                                        <td><b>Phone</b>{{user.mobile}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <div ng-show="userlist.length==0">
                                                <div class="alert alert-danger" role="alert">No receiver found </div>
                                            </div>
                                        </div>
                                        <hr />
                                        <h1>Transporter Details</h1>
                                        <div class="com-det">
                                            <table border="0" ng-show="userlist.length>0" cellpadding="4" width="100%">
                                                <tbody>
                                                    <tr ng-repeat="user in userlist">
                                                        <td><b>Trip Id</b>{{transporter.TripID}}</td>
                                                        <td><b>Departure On</b>{{transporter.dep_time}}</td>
                                                        <td><b>Arrival On</b>{{transporter.arrival_time}} </td>
                                                        <td><b>Flight No</b>{{transporter.flight_no}}</td>
                                                        <!--<td><b>PNR /Booking Reference</b>{{transporter.pnr}}</td>-->
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <div class="clear">&nbsp;</div>
                                            <div ng-show="userlist.length==0">
                                                <div class="alert alert-danger" role="alert">No receiver found </div>
                                            </div>
                                        </div>
                                        <div class="clear">
                                        </div>
                                        <div ng-show="orderlist.length==0" class="form-group">
                                            <div class="col-md-12">
                                                <input type="checkbox" id="voilet" ng-model="usewalletamount" ng-disabled="loginuser.wallet==0" />Use MCB Wallet Your awalable Amount {{loginuser.wallet | currency:"&#8377;"}}
                                            </div>
                                            <div class="col-md-12">
                                                <input class="customsearchbutton" style="font-size:15px;padding:10px 23px;float:right;text-shadow: 0px 1px 3px rgba(0, 0, 0, 0.4);  color:#fff;font-family: 'proxima_novasemibold'; text-transform:uppercase;    background: -moz-linear-gradient(270deg, rgba(144,193,81,1) 0%, rgba(107,162,35,1) 100%);     background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, rgba(144,193,81,1)), color-stop(100%, rgba(107,162,35,1)));     background: -webkit-linear-gradient(270deg, rgba(144,193,81,1) 0%, rgba(107,162,35,1) 100%);     background: -o-linear-gradient(270deg, rgba(144,193,81,1) 0%, rgba(107,162,35,1) 100%);      background: -ms-linear-gradient(270deg, rgba(144,193,81,1) 0%, rgba(107,162,35,1) 100%);     background: linear-gradient(180deg, rgba(144,193,81,1) 0%, rgba(107,162,35,1) 100%);     filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#90c151', endColorstr='#6ba223',GradientType=0 ); " type="submit" value="{{parcel.status==7?'Confirm Now':'Pay Now'}}">
                                            </div>
                                        </div>
                                    </form>
                                    <form ng-show="orderlist.length>0" action="/pay.php" class="stdform" id="accept-and-pay" enctype="multipart/form-data" method="post" accept-charset="utf-8">
                                        <input type="hidden" value="{{orderlist[0].ordernumber}}" name="txnid" />
                                        <input type="hidden" value="{{loginuser.name}}" name="firstname" />
                                        <input type="hidden" value="{{loginuser.username}}" name="email" />
                                        <input type="hidden" value="{{loginuser.mobile}}" name="phone" />
                                        <input type="hidden" value="Parcel#{{orderlist[0].AMOUNT}}" name="amount" />
                                        <input type="hidden" value="Parcel#{{parcel.id}}" name="productinfo" />
                                        <input type="hidden" value="http://dev9856.mycourierbuddy.in/pay.php" name="surl" />
                                        <input type="hidden" value="http://dev9856.mycourierbuddy.in/pay.php" name="furl" />
                                        <input type="hidden" name="service_provider" value="payu_paisa" size="64" />
                                        <div class="form-group">
                                            <div class="col-md-12">
                                                <input class="customsearchbutton" style="font-size:15px;padding:10px 23px;float:right;text-shadow: 0px 1px 3px rgba(0, 0, 0, 0.4);  color:#fff;font-family: 'proxima_novasemibold'; text-transform:uppercase;    background: -moz-linear-gradient(270deg, rgba(144,193,81,1) 0%, rgba(107,162,35,1) 100%);     background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, rgba(144,193,81,1)), color-stop(100%, rgba(107,162,35,1)));     background: -webkit-linear-gradient(270deg, rgba(144,193,81,1) 0%, rgba(107,162,35,1) 100%);     background: -o-linear-gradient(270deg, rgba(144,193,81,1) 0%, rgba(107,162,35,1) 100%);      background: -ms-linear-gradient(270deg, rgba(144,193,81,1) 0%, rgba(107,162,35,1) 100%);     background: linear-gradient(180deg, rgba(144,193,81,1) 0%, rgba(107,162,35,1) 100%);     filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#90c151', endColorstr='#6ba223',GradientType=0 ); " type="submit" value="Confirm">
                                            </div>
                                        </div>

                                    </form>
                                    <div id="book" class="pop-up-display-content">
                                        <div class="thanku regstr">
                                            <h6>Your request has been received and you will be notify if transporter agree to carry/book your parcel.</h6>
                                        </div>
                                    </div>
                                </div><div class="clear">&nbsp;&nbsp;</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div style="display:none"> 
        <div id="notif"></div>
        <audio id="notif_audio">
            <source src="/sounds/notify.ogg" type="audio/ogg">
            <source src="/sounds/notify.mp3'" type="audio/mpeg">
            <source src="/sounds/notify.wav" type="audio/wav">
        </audio>
    </div>
    <div class="popup-box chat-popup" id="qnimate">
        <div class="popup-head">
            <div class="popup-head-left pull-left">Chat Message</div>
            <div class="popup-head-right pull-right">
                <button data-widget="remove" id="removeClass" class="chat-header-button pull-right" type="button"><i class="glyphicon glyphicon-off"></i></button>
            </div>
        </div>
        <div class="popup-messages">
            <div class="direct-chat-messages"> 
                <div ng-repeat="mess in messages">
                    <div class="chat-box-single-line">
                        <abbr class="timestamp">{{mess.date | date:'MMM ,dd ,yyyy'}}</abbr>
                    </div>
                    <div ng-repeat="mo in mess.messages"> 
                        <div class="direct-chat-msg doted-border" ng-hide="loginuser.id==mo.id">
                            <div class="direct-chat-info clearfix" ng-hide="$index>0 && mess.messages[$index-1].id==mess.messages[$index].id">
                                <span class="direct-chat-name pull-left">{{mo.username}}</span>
                            </div>
                            <img alt="iamgurdeeposahan" src="/images/chatuser.png" class="direct-chat-img" ng-hide="$index>0 && mess.messages[$index-1].id==mess.messages[$index].id">
                            <div class="direct-chat-text">
                                {{mo.message}}
                            </div>
                            <div class="direct-chat-info clearfix">
                                <span class="direct-chat-timestamp pull-right">{{mo.created | date:"h:mma"}}</span>
                            </div>
                            <div class="direct-chat-info clearfix" ng-hide="$index>0 && mess.messages[$index].id==mess.messages[$index+1].id">
                                <span class="direct-chat-img-reply-small pull-left">

                                </span>
                            </div>
                        </div>
                        <div class="direct-chat-msg doted-borderright" ng-show="loginuser.id==mo.id">
                            <div class="direct-chat-info clearfix" ng-hide="$index>0 && mess.messages[$index-1].id==mess.messages[$index].id">
                                <span class="direct-chat-nameright pull-right">{{mo.username}}</span>
                            </div>
                            <img alt="iamgurdeeposahan" src="/images/chatuser.png" class="direct-chat-imgright" ng-hide="$index>0 && mess.messages[$index-1].id==mess.messages[$index].id">
                            <div class="direct-chat-textright">
                                {{mo.message}}
                            </div>
                            <div class="direct-chat-info clearfix">
                                <span class="direct-chat-timestamp pull-left">{{mo.created | date:"h:mma"}}</span>
                            </div>
                            <div class="direct-chat-info clearfix" ng-hide="$index>0 && mess.messages[$index].id==mess.messages[$index+1].id">
                                <span class="direct-chat-img-reply-small pull-right">

                                </span>
                            </div>
                        </div>
                    </div>
                </div> 
            </div>
        </div>
        <div class="popup-messages-footer"> 
            <form ng-submit="submitchat()">
                <input type="text" id="status_message" autocomplete="off" ng-model="chatmessage" required placeholder="Type a message..."  name="message" />
                <div class="btn-footer">
                    <button type="submit" class="bg_none pull-right"><i class="glyphicon glyphicon-send"></i> </button>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    $('.quote_date').Zebra_DatePicker({
        direction: true, pair: $('.quote_date1'), format: 'd-m-Y'
    });
    $('.quote_datesearch').Zebra_DatePicker({
        direction: true, pair: $('.quote_datesearch1'), format: 'd-m-Y'
    });
    $('.quote_datesearch1').Zebra_DatePicker({
        direction: true, format: 'd-m-Y'
    });
    $('#setTimeExample').timepicker();
    $('#setTimeExample1').timepicker();
    function createcourierrequest(id) {
        angular.element('.container').scope().createcourierrequest(id);
    }
    $(function () {
        $("#addClass").click(function () {
            $('#qnimate').addClass('popup-box-on');
            $(".popup-messages").animate({ scrollTop: 9999999 }, 50);
        });
        $("#removeClass").click(function () {
            $('#qnimate').removeClass('popup-box-on');
        });
    })
</script>
<style>
    .input-group, span.Zebra_DatePicker_Icon_Wrapper {
        width: 100%;
    }
</style>